#!/bin/sh

if ! [ "root" = "$(id -u -n)" ]; then
    echo "ERROR: ${0} must be run as root!"; exit 1
fi

# Stop OpenVPN
systemctl stop openvpn-server@\* --all

# Stop Web Server
systemctl stop httpd
systemctl stop php-fpm

# Install Updates
if [ -x "$(command -v dnf)" ]; then
    dnf -y --refresh update
elif [ -x "$(command -v yum)" ]; then
    yum clean expire-cache
    yum -y update
else
    echo "No dnf or yum available!"
    exit 1
fi

# Start Web Server
systemctl start php-fpm
systemctl start httpd

# Delete OpenVPN Configuration
rm -rf /etc/openvpn/server/*

# Regenerate OpenVPN Configuration 
vpn-server-node-server-config

# Start OpenVPN
systemctl start openvpn-server@\* --all
